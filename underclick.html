<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Underclick</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Courier New', monospace;
      background: #000 url("atras.gif") no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }
    .container { display: flex; flex-direction: row; height: 100vh; }
    .column { padding: 20px; overflow-y: auto; }
    .left-column {
      width: 20%;
      background-color: rgba(0, 0, 0, 0.6);
      text-align: center;
      position: relative;
      border-right: 2px solid rgba(255,255,255,.15);
    }
    .middle-column {
      width: 50%;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      border-left: 2px solid rgba(255, 255, 255, 0.2);
      border-right: 2px solid rgba(255, 255, 255, 0.2);
    }
    .right-column {
      width: 30%;
      background-color: rgba(0, 0, 0, 0.6);
      border-left: 2px solid rgba(255,255,255,.15);
    }

    #loveDisplay, #lovePerSec {
      font-size: 20px; margin: 10px 0; background: rgba(0,0,0,0.6);
      padding: 10px; border-radius: 8px;
    }

    #heart { cursor: pointer; transition: transform .1s; margin: 12px 0 6px; user-select: none; display: inline-block; }
    #heart:hover { transform: scale(1.1); }
    #heart img { height: 100px; width: auto; display: block; }

    #effectBar {
      width: 80%; height: 10px; background: linear-gradient(90deg, #ff3b3b, #ff9a00);
      margin: 10px auto 4px; border-radius: 5px; display: none; overflow: hidden;
      box-shadow: 0 0 12px rgba(255,154,0,.35), inset 0 0 6px rgba(0,0,0,.8);
    }
    #effectMsg { font-size: 12px; color: #ffb5a5; min-height: 16px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: .3px; }

    #musicToggle {
      margin: 6px auto 0;
      padding: 6px 10px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.35);
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
      font-family: inherit;
      font-size: 12px;
    }
    #musicToggle:hover { filter: brightness(1.08); }

    .scenario { position: relative; margin: 18px 0 22px; }
    .scenario img.bg { width: 100%; max-width: 300px; border-radius: 10px; border: 2px solid rgba(255,255,255,.15); }
    .scenario .characters { position: absolute; top: 0; left: 0; display: flex; flex-wrap: wrap; gap: 5px; padding: 10px; }
    .scenario .characters img { height: 50px; }

    #storeMenu {
      display: flex; gap: 10px; flex-wrap: wrap;
      background: rgba(255,255,255,.08); padding: 10px; border-radius: 8px; margin-bottom: 15px;
      border: 1px solid rgba(255,255,255,.15);
    }
    .icon-btn { background: transparent; border: none; padding: 4px; cursor: pointer; }
    .effect-icon {
      width: 28px; height: 28px; display: block; border-radius: 6px;
      background: rgba(255,255,255,.06); padding: 4px;
      transition: transform .15s ease, filter .15s ease, background .15s ease;
      border: 1px solid rgba(255,255,255,.12);
    }
    .icon-btn:hover .effect-icon { transform: scale(1.08); filter: brightness(1.1); background: rgba(255,255,255,.12); }

    #upgrades {
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.2);
      border-radius: 10px;
      padding: 8px;
      backdrop-filter: blur(2px);
    }
    .upgrade-head,
    .upgrade-row {
      display: grid;
      grid-template-columns: 1.6fr .9fr 1fr .8fr .9fr;
      gap: 10px; align-items: center;
    }
    .upgrade-head {
      padding: 12px 14px; margin-bottom: 6px; border-radius: 10px;
      background: #0a0a0a; border: 3px solid #ff9a00;
      color: #ffe08a; text-transform: uppercase; font-weight: 800;
      position: sticky; top: 0; z-index: 2;
    }
    .upgrade-row {
      padding: 12px 14px;
      background: linear-gradient(#090909, #0f0f0f);
      color: #ffe08a;
      border-left: 3px solid #ff9a00;
      border-right: 3px solid #ff9a00;
      position: relative;
    }
    .upgrade-row + .upgrade-row::before {
      content: ""; position: absolute; left: 0; right: 0; top: -1px; height: 2px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent);
    }
    .upgrade-row:hover { filter: brightness(1.06); }
    .upgrade-row .col-name { color: #ffa726; font-weight: 800; }
    .upgrade-row.can-buy  { box-shadow: 0 0 14px rgba(156,255,156,.25); border-color: #7dff7d; }
    .upgrade-row.cant-buy { opacity: .86; }
    .buy-btn {
      background: #ff9a00; color: #1a1a1a; border: 2px solid #ffd56b; padding: 8px 10px; border-radius: 6px;
      font-weight: 800; text-transform: uppercase; cursor: pointer;
    }
    .buy-btn:disabled { background: #4a4a4a; color: #cfcfcf; border-color: #7a7a7a; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="container">
    <div class="column left-column">
      <div id="loveDisplay">LOVE: <span id="loveCount">0</span></div>
      <div id="lovePerSec">LOVE/s: <span id="lovePerSecond">0</span></div>

      <div id="heart" onclick="clickHeart()">
        <img src="heart-click.png" alt="CoraÃ§Ã£o" />
      </div>

      <button id="musicToggle" onclick="toggleMusic()">ðŸŽµ MÃºsica: OFF</button>

      <div id="effectBar"></div>
      <div id="effectMsg"></div>
    </div>

    <div class="column middle-column" id="middlePanel"></div>

    <div class="column right-column">
      <div id="storeMenu">
        <button class="icon-btn" onclick="activateEffect('heart')" title="CoraÃ§Ã£o">
          <img class="effect-icon" src="heart.png" alt="CoraÃ§Ã£o">
        </button>
        <button class="icon-btn" onclick="activateEffect('fire')" title="Fogo">
          <img class="effect-icon" src="fire.png" alt="Fogo">
        </button>
        <button class="icon-btn" onclick="activateEffect('skull')" title="Caveira">
          <img class="effect-icon" src="skull.png" alt="Caveira">
        </button>
        <button class="icon-btn" onclick="activateEffect('flower')" title="Flor">
          <img class="effect-icon" src="flower.png" alt="Flor">
        </button>
        <button class="icon-btn" onclick="activateEffect('brain')" title="CÃ©rebro">
          <img class="effect-icon" src="brain.png" alt="CÃ©rebro">
        </button>
        <button class="icon-btn" onclick="activateEffect('bow')" title="Arco">
          <img class="effect-icon" src="bow.png" alt="Arco">
        </button>
        <button class="icon-btn" onclick="activateEffect('trident')" title="Tridente">
          <img class="effect-icon" src="trident.png" alt="Tridente">
        </button>
        <button class="icon-btn" onclick="activateEffect('knife')" title="Faca">
          <img class="effect-icon" src="knife.png" alt="Faca">
        </button>
      </div>

      <div id="upgrades"></div>
    </div>
  </div>

  <script>
    const sfx = {
      click  : new Audio('click.mp3'),
      buy    : new Audio('buy.mp3'),
      effect : new Audio('effect.mp3'),
      chara  : new Audio('chara-unlock.mp3')
    };
    const bgm = new Audio('bg-music.mp3');

    sfx.click.volume  = 0.35;
    sfx.buy.volume    = 0.35;
    sfx.effect.volume = 0.35;
    sfx.chara.volume  = 0.55;
    bgm.volume        = 0.25;
    bgm.loop = true;

    function playSfx(a){ try{ a.currentTime = 0; a.play(); }catch(e){} }

    function toggleMusic(){
      if (bgm.paused) {
        bgm.play().catch(()=>{});
        document.getElementById('musicToggle').textContent = 'ðŸŽµ MÃºsica: ON';
      } else {
        bgm.pause();
        document.getElementById('musicToggle').textContent = 'ðŸŽµ MÃºsica: OFF';
      }
    }

    function playCharaUnlock(){
      const wasPlaying = !bgm.paused;
      if (wasPlaying) bgm.pause();
      sfx.chara.currentTime = 0;
      sfx.chara.play().catch(()=>{});
      sfx.chara.onended = () => { if (wasPlaying) bgm.play().catch(()=>{}); };
    }

    let love = 0;
    let lovePerSecond = 0;
    let clickPower = 1;
    let costMultiplier = 1;

    const characterData = {
      frisk:   { img: 'char_frisk.png',   bg: 'bg_frisk.jpeg'   },
      toriel:  { img: 'char_toriel.png',  bg: 'bg_toriel.jpeg'  },
      sans:    { img: 'char_sans.png',    bg: 'bg_sans.jpeg'    },
      papyrus: { img: 'char_papyrus.png', bg: 'bg_papyrus.jpeg' },
      undyne:  { img: 'char_undyne.png',  bg: 'bg_undyne.jpeg'  },
      alphys:  { img: 'char_alphys.png',  bg: 'bg_alphys.jpeg'  },
      mettaton:{ img: 'char_mettaton.png',bg: 'bg_mettaton.jpeg' },
      asgore:  { img: 'char_asgore.png',  bg: 'bg_asgore.jpeg'  },
      chara:   { img: 'char_chara.png',   bg: 'bg_chara.jpeg'   }
    };

    const upgrades = [
      { id: 'frisk', name: 'Frisk', lps: 1,   cost: 10 },
      { id: 'toriel',name: 'Toriel',lps: 5,   cost: 50 },
      { id: 'sans',  name: 'Sans',  lps: 10,  cost: 200 },
      { id: 'papyrus',name:'Papyrus',lps: 20, cost: 500 },
      { id: 'undyne',name:'Undyne', lps: 40,  cost: 1000 },
      { id: 'alphys',name:'Alphys', lps: 60,  cost: 2500 },
      { id: 'mettaton',name:'Mettaton',lps:100,cost: 5000 },
      { id: 'asgore',name:'Asgore', lps:150,  cost: 10000 },
      { id: 'chara', name:'Chara',  lps:666,  cost: 66666, hidden: true }
    ];

    const state = {};
    const conditions = { heart: 10, fire: 5, skull: 3, flower: 2, brain: 1, bow: 1, trident: 1, knife: 1 };
    const scenarioMap = {};

    function showMsg(txt){
      const el = document.getElementById('effectMsg');
      el.textContent = txt;
      setTimeout(()=>{ if(el.textContent===txt) el.textContent=''; }, 1800);
    }

    function getCurrentCost(id){
      const st = state[id];
      return Math.floor(st.baseCost * Math.pow(1.15, st.qty) * costMultiplier);
    }

    function clickHeart() {
      love += clickPower;
      playSfx(sfx.click);
      updateDisplay();
    }

    function buyUpgrade(id) {
      const up = upgrades.find(u => u.id === id);
      const st = state[id];
      const price = getCurrentCost(id);

      if (love >= price) {
        love -= price;
        st.qty++;
        lovePerSecond += up.lps;
        playSfx(sfx.buy);
        updateDisplay();

        if (!scenarioMap[id]) createScenario(id);
        if (scenarioMap[id].count < 20) addCharacterToScenario(id);
      }
    }

    function createScenario(id) {
      const container = document.createElement("div");
      container.className = "scenario";
      container.innerHTML = `
        <img class="bg" src="${characterData[id].bg}" alt="cenÃ¡rio">
        <div class="characters" id="char_${id}"></div>
      `;
      document.getElementById("middlePanel").appendChild(container);
      scenarioMap[id] = { count: 0 };
    }

    function addCharacterToScenario(id) {
      const box = document.getElementById(`char_${id}`);
      const img = document.createElement("img");
      img.src = characterData[id].img;
      img.alt = id;
      box.appendChild(img);
      scenarioMap[id].count++;
    }

    function startEffectBar(durationMs){
      const bar = document.getElementById("effectBar");
      bar.style.display = 'block';
      bar.style.width = '100%';
      let elapsed = 0;
      const step = 100;
      const timer = setInterval(()=>{
        elapsed += step;
        const pct = Math.max(0, 100 - (elapsed / durationMs * 100));
        bar.style.width = pct + '%';
        if(elapsed >= durationMs){
          clearInterval(timer);
          bar.style.display = 'none';
          bar.style.width = '0%';
        }
      }, step);
    }

    function activateEffect(type) {
      const qty = id => state[id]?.qty || 0;
      const activate = (duration, effectFn, reverseFn) => {
        effectFn();
        startEffectBar(duration);
        setTimeout(() => { reverseFn && reverseFn(); updateDisplay(); }, duration);
      };

      if (type === 'heart' && qty('frisk') >= conditions.heart) {
        conditions.heart *= 2; showMsg('Efeito: clique x2 (10s)'); playSfx(sfx.effect);
        activate(10000, () => { clickPower *= 2; }, () => { clickPower /= 2; });

      } else if (type === 'fire' && qty('toriel') >= conditions.fire) {
        conditions.fire *= 2; showMsg('Efeito: LOVE/s x2 (15s)'); playSfx(sfx.effect);
        activate(15000, () => { lovePerSecond *= 2; }, () => { lovePerSecond /= 2; });

      } else if (type === 'skull' && qty('sans') >= conditions.skull) {
        love += 1000; conditions.skull *= 2; showMsg('+1000 LOVE'); playSfx(sfx.effect); updateDisplay();

      } else if (type === 'flower' && qty('papyrus') >= conditions.flower) {
        conditions.flower *= 2; showMsg('Custos /2 (10s)'); playSfx(sfx.effect);
        activate(10000, () => { costMultiplier *= 0.5; }, () => { costMultiplier *= 2; });

      } else if (type === 'brain' && qty('alphys') >= conditions.brain) {
        lovePerSecond += 50; conditions.brain *= 2; showMsg('+50 LOVE/s (perm.)'); playSfx(sfx.effect); updateDisplay();

      } else if (type === 'bow' && qty('undyne') >= conditions.bow) {
        conditions.bow *= 2; showMsg('LOVE/s x2 (10s)
